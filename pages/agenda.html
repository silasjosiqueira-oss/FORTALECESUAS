<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda - Sistema de Atendimento Social</title>

    <!-- CSS Externos -->
    <link rel="stylesheet" href="../css/base/reset.css">
    <link rel="stylesheet" href="../css/base/variables.css">
    <link rel="stylesheet" href="../css/base/typography.css">
    <link rel="stylesheet" href="../css/layout/sidebar.css">
    <link rel="stylesheet" href="../css/layout/header.css">
    <link rel="stylesheet" href="../css/layout/grid.css">
    <link rel="stylesheet" href="../css/layout/responsive.css">
    <link rel="stylesheet" href="../css/components/buttons.css">
    <link rel="stylesheet" href="../css/components/cards.css">
    <link rel="stylesheet" href="../css/components/forms.css">
    <link rel="stylesheet" href="../css/components/modal.css">
    <link rel="stylesheet" href="../css/main.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- jsPDF para exportação PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        .tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            color: #64748b;
            transition: all 0.3s;
        }

        .tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .tab:hover {
            color: #2563eb;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .calendar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .current-month {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .calendar-weekdays {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .calendar-day {
            height: 100px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .calendar-day:hover {
            background-color: #f8fafc;
        }

        .calendar-day.other-month {
            color: #94a3b8;
            background-color: #f8fafc;
        }

        .calendar-day.today {
            background-color: #dbeafe;
            border-color: #2563eb;
        }

        .calendar-day.has-events {
            border-color: #2563eb;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .event-preview {
            font-size: 0.75rem;
            padding: 0.125rem 0.25rem;
            border-radius: 4px;
            margin-bottom: 0.125rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .event-preview.agendamento {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .event-preview.atividade {
            background-color: #dcfce7;
            color: #166534;
        }

        .event-preview.reuniao {
            background-color: #fef3c7;
            color: #92400e;
        }

        .event-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .event-item {
            display: flex;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .event-time {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background-color: #f8fafc;
            min-width: 100px;
        }

        .event-hour {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .event-date {
            font-size: 0.875rem;
            color: #64748b;
        }

        .event-details {
            flex: 1;
            padding: 1rem;
        }

        .event-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }

        .event-description {
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .event-participants {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #64748b;
        }

        .event-actions {
            display: flex;
            align-items: center;
            padding: 1rem;
            gap: 0.5rem;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-ativo {
            background: #dcfce7;
            color: #166534;
        }

        .status-agendado {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-confirmado {
            background: #dcfce7;
            color: #166534;
        }

        .status-cancelado {
            background: #fee2e2;
            color: #991b1b;
        }

        .form-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .form-section h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn--sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 1rem;
        }

        .table-container table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .table-container th,
        .table-container td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .table-container th {
            font-weight: 600;
            color: #1e293b;
            background-color: #f8fafc;
        }

        .filter-section {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .presenca-list {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .presenca-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .presenca-item:last-child {
            border-bottom: none;
        }

        .export-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }

            .calendar-day {
                height: 60px;
                padding: 0.25rem;
                font-size: 0.875rem;
            }

            .event-preview {
                display: none;
            }

            .event-item {
                flex-direction: column;
            }

            .form-grid, .form-grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media print {
            .sidebar, .main-header, .tabs, .btn, button, .export-buttons {
                display: none !important;
            }
            .main-content {
                margin: 0;
                padding: 20px;
            }
            .card {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar__header">
                <div class="sidebar__logo">FS</div>
                <h1 class="sidebar__title">FORTALECE SUAS</h1>
            </div>
            <nav class="sidebar__nav">
                <ul>
                    <li><a href="index.html"><i class="fas fa-tachometer-alt"></i><span>Inicio</span></a></li>
                    <li><a href="atendimento.html"><i class="fas fa-users"></i><span>Atendimentos</span></a></li>
                    <li><a href="beneficios.html"><i class="fas fa-hand-holding-heart"></i><span>Benefícios</span></a></li>
                    <li><a href="agenda.html" class="active"><i class="fas fa-calendar-alt"></i><span>Agenda</span></a></li>
                    <li><a href="atividades.html"><i class="fas fa-users-cog"></i><span>Grupos/Atividades</span></a></li>
                    <li><a href="programas.html"><i class="fas fa-clipboard-list"></i><span>Programas</span></a></li>
                    <li><a href="relatorios.html"><i class="fas fa-file-alt"></i><span>Relatórios</span></a></li>
                    <li><a href="estatisticas.html"><i class="fas fa-chart-bar"></i><span>Estatísticas</span></a></li>
                    <li><a href="cadastros.html"><i class="fas fa-database"></i><span>Cadastros</span></a></li>
                    <li><a href="estoque.html"><i class="fas fa-boxes"></i><span>Estoque</span></a></li>
                    <li><a href="ferramentas.html"><i class="fas fa-tools"></i><span>Ferramentas</span></a></li>
                    <li><a href="configuracoes.html"><i class="fas fa-cogs"></i><span>Configurações</span></a></li>
                    <li><a href="suporte.html"><i class="fas fa-life-ring"></i><span>Suporte</span></a></li>
                    <li><a href="login.html"><i class="fas fa-sign-out-alt"></i><span>Logoff</span></a></li>
                </ul>
            </nav>
        </aside>

        <!-- Conteúdo Principal -->
        <main class="main-content">
            <header class="main-header">
                <div class="header-title">
                    <h2>Sistema Fortalece - Assistência Social</h2>
                </div>
                <div class="header-actions">
                    <button class="btn btn--icon"><i class="fas fa-bell"></i><span class="badge">3</span></button>
                    <button class="btn btn--icon"><i class="fas fa-cog"></i></button>
                    <button class="btn btn--secondary" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</button>
                </div>
            </header>

            <div class="content-wrapper">
                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" data-tab="calendario">Calendário</div>
                    <div class="tab" data-tab="agendamentos">Agendamentos</div>
                    <div class="tab" data-tab="atividades">Atividades Coletivas</div>
                    <div class="tab" data-tab="institucional">Agenda Institucional</div>
                </div>

                <!-- Aba Calendário -->
                <div class="tab-content active" id="tab-calendario">
                    <div class="card">
                        <div class="card-header">
                            <h3>Agenda do Mês</h3>
                            <div class="calendar-actions">
                                <button class="btn btn--outline" id="btn-mes-anterior">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span class="current-month">Carregando...</span>
                                <button class="btn btn--outline" id="btn-mes-proximo">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                                <button class="btn btn--primary" id="btn-novo-evento">
                                    <i class="fas fa-plus"></i> Novo
                                </button>
                                <button class="btn btn--success" onclick="agendaManager.imprimirCalendario()">
                                    <i class="fas fa-print"></i> Imprimir
                                </button>
                                <button class="btn btn--info" onclick="agendaManager.baixarPDF('calendario')">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="calendar-weekdays">
                                <div>Dom</div>
                                <div>Seg</div>
                                <div>Ter</div>
                                <div>Qua</div>
                                <div>Qui</div>
                                <div>Sex</div>
                                <div>Sáb</div>
                            </div>
                            <div class="calendar" id="calendar-grid"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Próximos Eventos</h3>
                            <button class="btn btn--outline" onclick="agendaManager.carregarEventos()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="event-list" id="proximos-eventos">
                                <p>Carregando eventos...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba Agendamentos -->
                <div class="tab-content" id="tab-agendamentos">
                    <div class="card">
                        <div class="card-header">
                            <h3>Agendamentos de Usuários</h3>
                            <div class="export-buttons">
                                <button class="btn btn--primary" id="btn-novo-agendamento">
                                    <i class="fas fa-plus"></i> Novo
                                </button>
                                <button class="btn btn--success" onclick="agendaManager.imprimirAgendamentos()">
                                    <i class="fas fa-print"></i> Imprimir
                                </button>
                                <button class="btn btn--info" onclick="agendaManager.baixarPDF('agendamentos')">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn btn--warning" onclick="agendaManager.gerarRelatorioAgendamentos()">
                                    <i class="fas fa-chart-bar"></i> Relatório
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Filtros -->
                            <div class="filter-section">
                                <h4><i class="fas fa-filter"></i> Filtros</h4>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Data Inicial</label>
                                        <input type="date" class="form-input" id="filtro-data-inicial">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Data Final</label>
                                        <input type="date" class="form-input" id="filtro-data-final">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Unidade</label>
                                        <select class="form-input" id="filtro-unidade">
                                            <option value="">Todas</option>
                                            <option value="CRAS Centro">CRAS Centro</option>
                                            <option value="CRAS Norte">CRAS Norte</option>
                                            <option value="CRAS Sul">CRAS Sul</option>
                                            <option value="CREAS">CREAS</option>
                                            <option value="Secretaria">Secretaria</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Status</label>
                                        <select class="form-input" id="filtro-status">
                                            <option value="">Todos</option>
                                            <option value="agendado">Agendado</option>
                                            <option value="confirmado">Confirmado</option>
                                            <option value="realizado">Realizado</option>
                                            <option value="cancelado">Cancelado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn--primary" onclick="agendaManager.filtrarAgendamentos()">
                                        <i class="fas fa-search"></i> Pesquisar
                                    </button>
                                    <button class="btn btn--outline" onclick="agendaManager.limparFiltros()">
                                        <i class="fas fa-times"></i> Limpar
                                    </button>
                                </div>
                            </div>

                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Data/Hora</th>
                                            <th>Usuário</th>
                                            <th>Serviço</th>
                                            <th>Unidade</th>
                                            <th>Formato</th>
                                            <th>Profissional</th>
                                            <th>Status</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabela-agendamentos">
                                        <tr><td colspan="8">Carregando...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba Atividades -->
                <div class="tab-content" id="tab-atividades">
                    <div class="card">
                        <div class="card-header">
                            <h3>Atividades Coletivas</h3>
                            <div class="export-buttons">
                                <button class="btn btn--primary" id="btn-nova-atividade">
                                    <i class="fas fa-plus"></i> Nova
                                </button>
                                <button class="btn btn--success" onclick="agendaManager.imprimirAtividades()">
                                    <i class="fas fa-print"></i> Imprimir
                                </button>
                                <button class="btn btn--info" onclick="agendaManager.baixarPDF('atividades')">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Atividade</th>
                                            <th>Descrição</th>
                                            <th>Dia/Horário</th>
                                            <th>Unidade</th>
                                            <th>Participantes</th>
                                            <th>Coordenador</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabela-atividades">
                                        <tr><td colspan="7">Carregando...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba Institucional -->
                <div class="tab-content" id="tab-institucional">
                    <div class="card">
                        <div class="card-header">
                            <h3>Agenda Institucional</h3>
                            <div class="export-buttons">
                                <button class="btn btn--primary" id="btn-novo-institucional">
                                    <i class="fas fa-plus"></i> Novo
                                </button>
                                <button class="btn btn--success" onclick="agendaManager.imprimirInstitucional()">
                                    <i class="fas fa-print"></i> Imprimir
                                </button>
                                <button class="btn btn--info" onclick="agendaManager.baixarPDF('institucional')">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="event-list" id="lista-institucional">
                                <p>Carregando eventos...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Novo Evento -->
    <div id="modal-novo-evento" class="modal">
        <div class="modal__content" style="max-width: 700px;">
            <button class="modal__close" onclick="agendaManager.fecharModal('modal-novo-evento')">&times;</button>
            <div class="modal__header">
                <h2>Novo Evento</h2>
            </div>
            <div class="modal__body">
                <form id="form-novo-evento">
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Tipo *</label>
                            <select class="form-input" name="tipo" required>
                                <option value="">Selecione...</option>
                                <option value="agendamento">Agendamento</option>
                                <option value="atividade">Atividade</option>
                                <option value="reuniao">Reunião</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unidade *</label>
                            <select class="form-input" name="unidade" required>
                                <option value="">Selecione...</option>
                                <option value="CRAS Centro">CRAS Centro</option>
                                <option value="CRAS Norte">CRAS Norte</option>
                                <option value="CRAS Sul">CRAS Sul</option>
                                <option value="CREAS">CREAS</option>
                                <option value="Secretaria">Secretaria</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Data *</label>
                            <input type="date" class="form-input" name="data" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Hora *</label>
                            <input type="time" class="form-input" name="hora" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Título *</label>
                        <input type="text" class="form-input" name="titulo" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descrição</label>
                        <textarea class="form-input" name="descricao" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" onclick="agendaManager.fecharModal('modal-novo-evento')">Cancelar</button>
                <button class="btn btn--primary" onclick="agendaManager.salvarEvento()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Novo Agendamento -->
    <div id="modal-novo-agendamento" class="modal">
        <div class="modal__content" style="max-width: 700px;">
            <button class="modal__close" onclick="agendaManager.fecharModal('modal-novo-agendamento')">&times;</button>
            <div class="modal__header">
                <h2>Novo Agendamento</h2>
            </div>
            <div class="modal__body">
                <form id="form-novo-agendamento">
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Usuário *</label>
                            <input type="text" class="form-input" name="usuario" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">CPF/NIS</label>
                            <input type="text" class="form-input" name="cpf_nis">
                        </div>
                    </div>
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Serviço *</label>
                            <input type="text" class="form-input" name="servico" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unidade *</label>
                            <select class="form-input" name="unidade" required>
                                <option value="">Selecione...</option>
                                <option value="CRAS Centro">CRAS Centro</option>
                                <option value="CRAS Norte">CRAS Norte</option>
                                <option value="CRAS Sul">CRAS Sul</option>
                                <option value="CREAS">CREAS</option>
                                <option value="Secretaria">Secretaria</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Formato *</label>
                            <select class="form-input" name="formato" required>
                                <option value="">Selecione...</option>
                                <option value="Presencial">Presencial</option>
                                <option value="Telefone">Telefone</option>
                                <option value="Virtual">Virtual (Vídeo)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Profissional</label>
                            <input type="text" class="form-input" name="profissional">
                        </div>
                    </div>
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Data *</label>
                            <input type="date" class="form-input" name="data" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Hora *</label>
                            <input type="time" class="form-input" name="hora" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observações</label>
                        <textarea class="form-input" name="observacoes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" onclick="agendaManager.fecharModal('modal-novo-agendamento')">Cancelar</button>
                <button class="btn btn--primary" onclick="agendaManager.salvarAgendamento()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Nova Atividade -->
    <div id="modal-nova-atividade" class="modal">
        <div class="modal__content" style="max-width: 700px;">
            <button class="modal__close" onclick="agendaManager.fecharModal('modal-nova-atividade')">&times;</button>
            <div class="modal__header">
                <h2>Nova Atividade Coletiva</h2>
            </div>
            <div class="modal__body">
                <form id="form-nova-atividade">
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Atividade *</label>
                            <input type="text" class="form-input" name="titulo" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unidade *</label>
                            <select class="form-input" name="unidade" required>
                                <option value="">Selecione...</option>
                                <option value="CRAS Centro">CRAS Centro</option>
                                <option value="CRAS Norte">CRAS Norte</option>
                                <option value="CRAS Sul">CRAS Sul</option>
                                <option value="CREAS">CREAS</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descrição</label>
                        <textarea class="form-input" name="descricao" rows="2"></textarea>
                    </div>
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Dia da Semana *</label>
                            <select class="form-input" name="dia_semana" required>
                                <option value="">Selecione...</option>
                                <option value="Segundas">Segundas-feiras</option>
                                <option value="Terças">Terças-feiras</option>
                                <option value="Quartas">Quartas-feiras</option>
                                <option value="Quintas">Quintas-feiras</option>
                                <option value="Sextas">Sextas-feiras</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Horário *</label>
                            <input type="text" class="form-input" name="horario" placeholder="Ex: 14:00-16:00" required>
                        </div>
                    </div>
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Coordenador/Educador *</label>
                            <input type="text" class="form-input" name="coordenador" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Vagas</label>
                            <input type="number" class="form-input" name="vagas" min="1" value="15">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observações</label>
                        <textarea class="form-input" name="observacoes" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" onclick="agendaManager.fecharModal('modal-nova-atividade')">Cancelar</button>
                <button class="btn btn--primary" onclick="agendaManager.salvarAtividade()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Novo Institucional -->
    <div id="modal-novo-institucional" class="modal">
        <div class="modal__content" style="max-width: 700px;">
            <button class="modal__close" onclick="agendaManager.fecharModal('modal-novo-institucional')">&times;</button>
            <div class="modal__header">
                <h2>Novo Evento Institucional</h2>
            </div>
            <div class="modal__body">
                <form id="form-novo-institucional">
                    <div class="form-group">
                        <label class="form-label">Título *</label>
                        <input type="text" class="form-input" name="titulo" required>
                    </div>
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label class="form-label">Data *</label>
                            <input type="date" class="form-input" name="data" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Horário *</label>
                            <input type="time" class="form-input" name="hora" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pauta *</label>
                        <textarea class="form-input" name="pauta" rows="3" required placeholder="Descreva a pauta da reunião..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quem irá Representar *</label>
                        <textarea class="form-input" name="representantes" rows="2" required placeholder="Liste os órgãos/pessoas que participarão..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Local</label>
                        <input type="text" class="form-input" name="local" placeholder="Ex: Sala de reuniões - CRAS Centro">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observações</label>
                        <textarea class="form-input" name="observacoes" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" onclick="agendaManager.fecharModal('modal-novo-institucional')">Cancelar</button>
                <button class="btn btn--primary" onclick="agendaManager.salvarInstitucional()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Lista de Presença -->
    <div id="modal-lista-presenca" class="modal">
        <div class="modal__content" style="max-width: 600px;">
            <button class="modal__close" onclick="agendaManager.fecharModal('modal-lista-presenca')">&times;</button>
            <div class="modal__header">
                <h2>Lista de Presença</h2>
            </div>
            <div class="modal__body">
                <div id="presenca-info"></div>
                <div class="presenca-list" id="lista-presenca-container">
                    <!-- Gerado dinamicamente -->
                </div>
                <div style="margin-top: 1rem;">
                    <button class="btn btn--success" onclick="agendaManager.imprimirListaPresenca()">
                        <i class="fas fa-print"></i> Imprimir Lista
                    </button>
                    <button class="btn btn--info" onclick="agendaManager.exportarPresencaExcel()">
                        <i class="fas fa-file-excel"></i> Exportar Excel
                    </button>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--primary" onclick="agendaManager.fecharModal('modal-lista-presenca')">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading" id="loading-overlay">
        <div style="text-align: center;">
            <div class="spinner"></div>
            <h4>Carregando...</h4>
        </div>
    </div>

    <script>
// ==========================================
// CONFIGURAÇÃO GLOBAL
// ==========================================
const API_BASE = '/api/agenda';
let eventosCache = [];
let agendamentosCache = [];
let atividadesCache = [];
let institucionalCache = [];

// ==========================================
// CLASSE AGENDAMANAGER COMPLETA
// ==========================================
class AgendaManager {
    constructor() {
        this.currentMonth = new Date();
        this.token = null;
        this.init();
    }

    async init() {
        if (!this.verificarAutenticacao()) return;
        this.token = localStorage.getItem('token');
        this.inicializarAbas();
        this.inicializarEventListeners();
        await this.carregarDadosIniciais();
    }

    verificarAutenticacao() {
        const token = localStorage.getItem('token');
        if (!token) {
            this.mostrarNotificacao('Faça login primeiro', 'warning');
            setTimeout(() => window.location.href = '/pages/login.html', 2000);
            return false;
        }
        return true;
    }

    getHeaders() {
        return {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${this.token}`
        };
    }

    async handleResponse(response) {
        if (response.status === 401) {
            this.mostrarNotificacao('Sessão expirada', 'error');
            localStorage.removeItem('token');
            setTimeout(() => window.location.href = '/pages/login.html', 2000);
            throw new Error('Não autenticado');
        }
        if (response.status === 403) {
            this.mostrarNotificacao('Sem permissão', 'error');
            throw new Error('Sem permissão');
        }
        if (!response.ok) {
            const error = await response.json().catch(() => ({}));
            throw new Error(error.error || `Erro HTTP: ${response.status}`);
        }
        return response.json();
    }

    // ==========================================
    // CONTROLE DE ABAS
    // ==========================================
    inicializarAbas() {
        const tabs = document.querySelectorAll('.tab');
        const contents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                contents.forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                const target = tab.getAttribute('data-tab');
                document.getElementById(`tab-${target}`)?.classList.add('active');
                this.carregarDadosAba(target);
            });
        });
    }

    // ==========================================
    // EVENT LISTENERS
    // ==========================================
    inicializarEventListeners() {
        document.getElementById('btn-novo-evento')?.addEventListener('click', () =>
            this.abrirModal('modal-novo-evento'));
        document.getElementById('btn-novo-agendamento')?.addEventListener('click', () =>
            this.abrirModal('modal-novo-agendamento'));
        document.getElementById('btn-nova-atividade')?.addEventListener('click', () =>
            this.abrirModal('modal-nova-atividade'));
        document.getElementById('btn-novo-institucional')?.addEventListener('click', () =>
            this.abrirModal('modal-novo-institucional'));

        document.getElementById('btn-mes-anterior')?.addEventListener('click', () => {
            this.currentMonth.setMonth(this.currentMonth.getMonth() - 1);
            this.atualizarCalendario();
        });
        document.getElementById('btn-mes-proximo')?.addEventListener('click', () => {
            this.currentMonth.setMonth(this.currentMonth.getMonth() + 1);
            this.atualizarCalendario();
        });

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) this.fecharModal(modal.id);
            });
        });
    }

    // ==========================================
    // MODAIS
    // ==========================================
    abrirModal(id) {
        document.getElementById(id).style.display = 'flex';
    }

    fecharModal(id) {
        const modal = document.getElementById(id);
        modal.style.display = 'none';
        modal.querySelector('form')?.reset();
    }

    // ==========================================
    // CARREGAR DADOS
    // ==========================================
    async carregarDadosIniciais() {
        try {
            this.showLoading();
            await Promise.all([
                this.carregarEventos(),
                this.carregarAgendamentos(),
                this.carregarAtividades(),
                this.carregarInstitucional()
            ]);
            this.atualizarCalendario();
        } catch (error) {
            console.error('Erro:', error);
        } finally {
            this.hideLoading();
        }
    }

    carregarDadosAba(aba) {
        switch(aba) {
            case 'agendamentos': this.carregarAgendamentos(); break;
            case 'atividades': this.carregarAtividades(); break;
            case 'institucional': this.carregarInstitucional(); break;
            default: this.carregarEventos();
        }
    }

    // ==========================================
    // CRUD EVENTOS
    // ==========================================
    async carregarEventos() {
        try {
            const response = await fetch(`${API_BASE}/eventos`, { headers: this.getHeaders() });
            eventosCache = await this.handleResponse(response);
            this.renderizarEventosCalendario(eventosCache);
            this.renderizarProximosEventos(eventosCache);
        } catch (error) {
            console.error('Erro:', error);
        }
    }

    async salvarEvento() {
        try {
            const form = document.getElementById('form-novo-evento');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const formData = new FormData(form);
            const dados = {
                tipo: formData.get('tipo'),
                unidade: formData.get('unidade'),
                data: formData.get('data'),
                hora: formData.get('hora'),
                titulo: formData.get('titulo'),
                descricao: formData.get('descricao') || '',
                status: 'agendado'
            };

            this.showLoading();
            const response = await fetch(`${API_BASE}/eventos`, {
                method: 'POST',
                headers: this.getHeaders(),
                body: JSON.stringify(dados)
            });

            await this.handleResponse(response);
            this.mostrarNotificacao('Evento salvo!', 'success');
            this.fecharModal('modal-novo-evento');
            await this.carregarEventos();
        } catch (error) {
            if (error.message !== 'Não autenticado') {
                this.mostrarNotificacao('Erro: ' + error.message, 'error');
            }
        } finally {
            this.hideLoading();
        }
    }

    async excluirEvento(id) {
        if (!confirm('Excluir este evento?')) return;
        try {
            this.showLoading();
            await fetch(`${API_BASE}/eventos/${id}`, {
                method: 'DELETE',
                headers: this.getHeaders()
            });
            this.mostrarNotificacao('Evento excluído!', 'success');
            await this.carregarEventos();
        } catch (error) {
            this.mostrarNotificacao('Erro ao excluir', 'error');
        } finally {
            this.hideLoading();
        }
    }

    // ==========================================
    // CRUD AGENDAMENTOS
    // ==========================================
    async carregarAgendamentos() {
        try {
            const response = await fetch(`${API_BASE}/agendamentos`, { headers: this.getHeaders() });
            agendamentosCache = await this.handleResponse(response);
            this.renderizarTabelaAgendamentos(agendamentosCache);
        } catch (error) {
            console.error('Erro:', error);
        }
    }

    async salvarAgendamento() {
        try {
            const form = document.getElementById('form-novo-agendamento');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const formData = new FormData(form);
            const dados = {
                usuario: formData.get('usuario'),
                cpf_nis: formData.get('cpf_nis') || '',
                servico: formData.get('servico'),
                unidade: formData.get('unidade'),
                formato: formData.get('formato'),
                profissional: formData.get('profissional') || 'A definir',
                data: formData.get('data'),
                hora: formData.get('hora'),
                observacoes: formData.get('observacoes') || '',
                status: 'agendado'
            };

            this.showLoading();
            const response = await fetch(`${API_BASE}/agendamentos`, {
                method: 'POST',
                headers: this.getHeaders(),
                body: JSON.stringify(dados)
            });

            await this.handleResponse(response);
            this.mostrarNotificacao('Agendamento salvo!', 'success');
            this.fecharModal('modal-novo-agendamento');
            await this.carregarAgendamentos();
        } catch (error) {
            if (error.message !== 'Não autenticado') {
                this.mostrarNotificacao('Erro: ' + error.message, 'error');
            }
        } finally {
            this.hideLoading();
        }
    }

    async excluirAgendamento(id) {
        if (!confirm('Excluir agendamento?')) return;
        try {
            this.showLoading();
            await fetch(`${API_BASE}/agendamentos/${id}`, {
                method: 'DELETE',
                headers: this.getHeaders()
            });
            this.mostrarNotificacao('Agendamento excluído!', 'success');
            await this.carregarAgendamentos();
        } catch (error) {
            this.mostrarNotificacao('Erro ao excluir', 'error');
        } finally {
            this.hideLoading();
        }
    }

    // ==========================================
    // CRUD ATIVIDADES
    // ==========================================
    async carregarAtividades() {
        try {
            const response = await fetch(`${API_BASE}/atividades`, { headers: this.getHeaders() });
            atividadesCache = await this.handleResponse(response);
            this.renderizarTabelaAtividades(atividadesCache);
        } catch (error) {
            console.error('Erro:', error);
        }
    }

    async salvarAtividade() {
        try {
            const form = document.getElementById('form-nova-atividade');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const formData = new FormData(form);
            const dados = {
                titulo: formData.get('titulo'),
                unidade: formData.get('unidade'),
                descricao: formData.get('descricao') || '',
                dia_semana: formData.get('dia_semana'),
                horario: formData.get('horario'),
                coordenador: formData.get('coordenador'),
                vagas: parseInt(formData.get('vagas')) || 15,
                participantes: 0,
                observacoes: formData.get('observacoes') || '',
                status: 'ativo'
            };

            this.showLoading();
            const response = await fetch(`${API_BASE}/atividades`, {
                method: 'POST',
                headers: this.getHeaders(),
                body: JSON.stringify(dados)
            });

            await this.handleResponse(response);
            this.mostrarNotificacao('Atividade salva!', 'success');
            this.fecharModal('modal-nova-atividade');
            await this.carregarAtividades();
        } catch (error) {
            if (error.message !== 'Não autenticado') {
                this.mostrarNotificacao('Erro: ' + error.message, 'error');
            }
        } finally {
            this.hideLoading();
        }
    }

    // ==========================================
    // CRUD INSTITUCIONAL
    // ==========================================
    async carregarInstitucional() {
        try {
            const response = await fetch(`${API_BASE}/institucional`, { headers: this.getHeaders() });
            institucionalCache = await this.handleResponse(response);
            this.renderizarInstitucional(institucionalCache);
        } catch (error) {
            console.error('Erro:', error);
        }
    }

    async salvarInstitucional() {
        try {
            const form = document.getElementById('form-novo-institucional');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const formData = new FormData(form);
            const dados = {
                titulo: formData.get('titulo'),
                data: formData.get('data'),
                hora: formData.get('hora'),
                pauta: formData.get('pauta'),
                representantes: formData.get('representantes'),
                local: formData.get('local') || '',
                observacoes: formData.get('observacoes') || '',
                status: 'agendado'
            };

            this.showLoading();
            const response = await fetch(`${API_BASE}/institucional`, {
                method: 'POST',
                headers: this.getHeaders(),
                body: JSON.stringify(dados)
            });

            await this.handleResponse(response);
            this.mostrarNotificacao('Evento institucional salvo!', 'success');
            this.fecharModal('modal-novo-institucional');
            await this.carregarInstitucional();
        } catch (error) {
            if (error.message !== 'Não autenticado') {
                this.mostrarNotificacao('Erro: ' + error.message, 'error');
            }
        } finally {
            this.hideLoading();
        }
    }

    // ==========================================
    // FILTROS
    // ==========================================
    filtrarAgendamentos() {
        const dataInicial = document.getElementById('filtro-data-inicial').value;
        const dataFinal = document.getElementById('filtro-data-final').value;
        const unidade = document.getElementById('filtro-unidade').value;
        const status = document.getElementById('filtro-status').value;

        let filtrados = [...agendamentosCache];

        if (dataInicial) {
            filtrados = filtrados.filter(a => a.data >= dataInicial);
        }
        if (dataFinal) {
            filtrados = filtrados.filter(a => a.data <= dataFinal);
        }
        if (unidade) {
            filtrados = filtrados.filter(a => a.unidade === unidade);
        }
        if (status) {
            filtrados = filtrados.filter(a => a.status === status);
        }

        this.renderizarTabelaAgendamentos(filtrados);
        this.mostrarNotificacao(`${filtrados.length} agendamento(s) encontrado(s)`, 'info');
    }

    limparFiltros() {
        document.getElementById('filtro-data-inicial').value = '';
        document.getElementById('filtro-data-final').value = '';
        document.getElementById('filtro-unidade').value = '';
        document.getElementById('filtro-status').value = '';
        this.renderizarTabelaAgendamentos(agendamentosCache);
    }

    // ==========================================
    // RENDERIZAÇÃO
    // ==========================================
    atualizarCalendario() {
        const currentMonthElement = document.querySelector('.current-month');
        if (currentMonthElement) {
            const options = { year: 'numeric', month: 'long' };
            currentMonthElement.textContent = this.currentMonth.toLocaleDateString('pt-BR', options);
        }
        this.gerarCalendario();
        this.renderizarEventosCalendario(eventosCache);
    }

    gerarCalendario() {
        const calendar = document.getElementById('calendar-grid');
        if (!calendar) return;

        calendar.innerHTML = '';
        const ano = this.currentMonth.getFullYear();
        const mes = this.currentMonth.getMonth();
        const primeiroDia = new Date(ano, mes, 1).getDay();
        const ultimoDia = new Date(ano, mes + 1, 0).getDate();
        const mesAnterior = new Date(ano, mes, 0).getDate();

        for (let i = primeiroDia - 1; i >= 0; i--) {
            calendar.appendChild(this.criarDiaCalendario(mesAnterior - i, true));
        }

        const hoje = new Date();
        for (let dia = 1; dia <= ultimoDia; dia++) {
            const isToday = hoje.getFullYear() === ano &&
                           hoje.getMonth() === mes &&
                           hoje.getDate() === dia;
            calendar.appendChild(this.criarDiaCalendario(dia, false, isToday));
        }

        const diasRestantes = 42 - (primeiroDia + ultimoDia);
        for (let dia = 1; dia <= diasRestantes; dia++) {
            calendar.appendChild(this.criarDiaCalendario(dia, true));
        }
    }

    criarDiaCalendario(numero, outroMes = false, isToday = false) {
        const dia = document.createElement('div');
        dia.className = 'calendar-day';
        if (outroMes) dia.classList.add('other-month');
        if (isToday) dia.classList.add('today');

        const numeroDia = document.createElement('div');
        numeroDia.className = 'day-number';
        numeroDia.textContent = numero;
        dia.appendChild(numeroDia);
        return dia;
    }

    renderizarEventosCalendario(eventos) {
        document.querySelectorAll('.calendar-day .event-preview').forEach(el => el.remove());

        eventos.forEach(evento => {
            const dataEvento = new Date(`${evento.data}T${evento.hora}`);
            const dia = dataEvento.getDate();
            const mes = dataEvento.getMonth();
            const ano = dataEvento.getFullYear();

            if (mes === this.currentMonth.getMonth() && ano === this.currentMonth.getFullYear()) {
                const dias = document.querySelectorAll('.calendar-day:not(.other-month)');
                const diaElement = Array.from(dias).find(diaEl => {
                    const numeroDia = parseInt(diaEl.querySelector('.day-number').textContent);
                    return numeroDia === dia;
                });

                if (diaElement) {
                    const eventoElement = document.createElement('div');
                    eventoElement.className = `event-preview ${evento.tipo}`;
                    eventoElement.textContent = evento.titulo;
                    eventoElement.title = evento.descricao || evento.titulo;
                    diaElement.appendChild(eventoElement);
                    diaElement.classList.add('has-events');
                }
            }
        });
    }

    renderizarProximosEventos(eventos) {
        const container = document.getElementById('proximos-eventos');
        if (!container) return;

        const agora = new Date();
        const eventosFuturos = eventos
            .filter(e => new Date(`${e.data}T${e.hora}`) > agora)
            .sort((a, b) => new Date(`${a.data}T${a.hora}`) - new Date(`${b.data}T${b.hora}`))
            .slice(0, 5);

        if (eventosFuturos.length === 0) {
            container.innerHTML = '<p>Nenhum evento futuro.</p>';
            return;
        }

        container.innerHTML = eventosFuturos.map(e => `
            <div class="event-item">
                <div class="event-time">
                    <div class="event-hour">${e.hora}</div>
                    <div class="event-date">${new Date(e.data).toLocaleDateString('pt-BR')}</div>
                </div>
                <div class="event-details">
                    <div class="event-title">${e.titulo}</div>
                    <div class="event-description">${e.descricao || ''}</div>
                    <div class="event-participants"><i class="fas fa-map-marker-alt"></i> ${e.unidade || ''}</div>
                </div>
                <div class="event-actions">
                    <button class="btn btn--sm btn--outline" onclick="agendaManager.excluirEvento(${e.id})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }

    renderizarTabelaAgendamentos(agendamentos) {
        const tbody = document.getElementById('tabela-agendamentos');
        if (!tbody) return;

        if (agendamentos.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8">Nenhum agendamento.</td></tr>';
            return;
        }

        tbody.innerHTML = agendamentos.map(ag => `
            <tr>
                <td>${new Date(ag.data).toLocaleDateString('pt-BR')} ${ag.hora}</td>
                <td>${ag.usuario}</td>
                <td>${ag.servico}</td>
                <td>${ag.unidade || '-'}</td>
                <td>${ag.formato || '-'}</td>
                <td>${ag.profissional || '-'}</td>
                <td><span class="status-badge status-${ag.status}">${ag.status}</span></td>
                <td class="table-actions">
                    <button class="btn btn--sm btn--outline" onclick="agendaManager.excluirAgendamento(${ag.id})" title="Excluir">
                        <i class="fas fa-times"></i>
                    </button>
                </td>
            </tr>
        `).join('');
    }

    renderizarTabelaAtividades(atividades) {
        const tbody = document.getElementById('tabela-atividades');
        if (!tbody) return;

        if (atividades.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7">Nenhuma atividade.</td></tr>';
            return;
        }

        tbody.innerHTML = atividades.map(at => `
            <tr>
                <td>${at.titulo}</td>
                <td>${at.descricao || '-'}</td>
                <td>${at.dia_semana}, ${at.horario}</td>
                <td>${at.unidade || '-'}</td>
                <td>${at.participantes}/${at.vagas || '-'}</td>
                <td>${at.coordenador || '-'}</td>
                <td class="table-actions">
                    <button class="btn btn--sm btn--outline" onclick="agendaManager.abrirListaPresenca(${at.id})" title="Lista Presença">
                        <i class="fas fa-clipboard-check"></i>
                    </button>
                </td>
            </tr>
        `).join('');
    }

    renderizarInstitucional(institucional) {
        const container = document.getElementById('lista-institucional');
        if (!container) return;

        if (institucional.length === 0) {
            container.innerHTML = '<p>Nenhum evento institucional.</p>';
            return;
        }

        container.innerHTML = institucional.map(e => `
            <div class="event-item">
                <div class="event-time">
                    <div class="event-hour">${e.hora}</div>
                    <div class="event-date">${new Date(e.data).toLocaleDateString('pt-BR')}</div>
                </div>
                <div class="event-details">
                    <div class="event-title">${e.titulo}</div>
                    <div class="event-description"><strong>Pauta:</strong> ${e.pauta || '-'}</div>
                    <div class="event-participants">
                        <i class="fas fa-users"></i> ${e.representantes || '-'}
                    </div>
                </div>
                <div class="event-actions">
                    <button class="btn btn--sm btn--outline" onclick="agendaManager.visualizarInstitucional(${e.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }

    // ==========================================
    // LISTA DE PRESENÇA
    // ==========================================
    abrirListaPresenca(atividadeId) {
        const atividade = atividadesCache.find(a => a.id === atividadeId);
        if (!atividade) return;

        const infoDiv = document.getElementById('presenca-info');
        infoDiv.innerHTML = `
            <h4>${atividade.titulo}</h4>
            <p><strong>Coordenador:</strong> ${atividade.coordenador}</p>
            <p><strong>Horário:</strong> ${atividade.dia_semana}, ${atividade.horario}</p>
        `;

        // Mock de participantes
        const participantes = [
            { nome: 'Maria Silva', presente: true },
            { nome: 'João Santos', presente: true },
            { nome: 'Ana Costa', presente: false }
        ];

        const container = document.getElementById('lista-presenca-container');
        container.innerHTML = participantes.map((p, i) => `
            <div class="presenca-item">
                <span>${i + 1}. ${p.nome}</span>
                <input type="checkbox" ${p.presente ? 'checked' : ''}>
            </div>
        `).join('');

        this.abrirModal('modal-lista-presenca');
    }

    imprimirListaPresenca() {
        window.print();
    }

    exportarPresencaExcel() {
        this.mostrarNotificacao('Exportação Excel em desenvolvimento', 'info');
    }

    // ==========================================
    // EXPORTAÇÃO/IMPRESSÃO
    // ==========================================
    imprimirCalendario() {
        window.print();
    }

    imprimirAgendamentos() {
        window.print();
    }

    imprimirAtividades() {
        window.print();
    }

    imprimirInstitucional() {
        window.print();
    }

    async baixarPDF(tipo) {
        this.mostrarNotificacao('Gerando PDF...', 'info');

        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(16);
            doc.text(`Relatório de ${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`, 20, 20);
            doc.setFontSize(10);
            doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 20, 30);

            // Aqui você adicionaria o conteúdo específico
            doc.text('Conteúdo do relatório...', 20, 40);

            doc.save(`agenda_${tipo}_${Date.now()}.pdf`);
            this.mostrarNotificacao('PDF gerado com sucesso!', 'success');
        } catch (error) {
            this.mostrarNotificacao('Erro ao gerar PDF', 'error');
        }
    }

    gerarRelatorioAgendamentos() {
        const dataInicial = document.getElementById('filtro-data-inicial').value;
        const dataFinal = document.getElementById('filtro-data-final').value;

        let dados = agendamentosCache;
        if (dataInicial) dados = dados.filter(a => a.data >= dataInicial);
        if (dataFinal) dados = dados.filter(a => a.data <= dataFinal);

        const totalAgendamentos = dados.length;
        const porUnidade = {};
        const porStatus = {};

        dados.forEach(ag => {
            porUnidade[ag.unidade] = (porUnidade[ag.unidade] || 0) + 1;
            porStatus[ag.status] = (porStatus[ag.status] || 0) + 1;
        });

        alert(`RELATÓRIO DE AGENDAMENTOS\n\nTotal: ${totalAgendamentos}\n\nPor Unidade:\n${Object.entries(porUnidade).map(([k,v]) => `${k}: ${v}`).join('\n')}\n\nPor Status:\n${Object.entries(porStatus).map(([k,v]) => `${k}: ${v}`).join('\n')}`);
    }

    visualizarInstitucional(id) {
        const evento = institucionalCache.find(e => e.id === id);
        if (evento) {
            alert(`${evento.titulo}\n\nData: ${new Date(evento.data).toLocaleDateString('pt-BR')} ${evento.hora}\n\nPauta:\n${evento.pauta}\n\nRepresentantes:\n${evento.representantes}`);
        }
    }

    // ==========================================
    // UTILITÁRIOS
    // ==========================================
    showLoading() {
        document.getElementById('loading-overlay').style.display = 'flex';
    }

    hideLoading() {
        document.getElementById('loading-overlay').style.display = 'none';
    }

    mostrarNotificacao(mensagem, tipo = 'info') {
        const notificacao = document.createElement('div');
        notificacao.className = `alert alert-${tipo}`;
        notificacao.style.cssText = `
            position: fixed; top: 20px; right: 20px; z-index: 10000;
            min-width: 300px; padding: 1rem; border-radius: 8px;
            display: flex; align-items: center; gap: 0.5rem;
        `;

        const cores = {
            success: { bg: '#f0fdf4', color: '#166534', border: '#bbf7d0' },
            error: { bg: '#fef2f2', color: '#b91c1c', border: '#fecaca' },
            warning: { bg: '#fffbeb', color: '#d97706', border: '#fed7aa' },
            info: { bg: '#eff6ff', color: '#1e40af', border: '#bfdbfe' }
        };

        const cor = cores[tipo] || cores.info;
        notificacao.style.backgroundColor = cor.bg;
        notificacao.style.color = cor.color;
        notificacao.style.border = `1px solid ${cor.border}`;

        const icones = {
            success: 'check-circle',
            error: 'exclamation-circle',
            warning: 'exclamation-triangle',
            info: 'info-circle'
        };

        notificacao.innerHTML = `
            <i class="fas fa-${icones[tipo] || 'info-circle'}"></i>
            <span>${mensagem}</span>
            <button onclick="this.parentElement.remove()" style="background: none; border: none; margin-left: auto; cursor: pointer; font-size: 1.25rem;">&times;</button>
        `;

        document.body.appendChild(notificacao);
        setTimeout(() => notificacao.remove(), 5000);
    }
}

// ==========================================
// INICIALIZAÇÃO
// ==========================================
let agendaManager;
document.addEventListener('DOMContentLoaded', () => {
    agendaManager = new AgendaManager();
});

function logout() {
    if (confirm('Sair do sistema?')) {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = '/pages/login.html';
    }
}
    </script>
</body>
</html>
